<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portworx ROI Calculator</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load Babel for JSX support -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map to resolve bare module specifiers used by dependencies -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom": "https://esm.sh/react-dom@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "recharts": "https://esm.sh/recharts@2.12.2?external=react,react-dom",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0?external=react"
        }
    }
    </script>

    <!-- Custom Styles for Scrollbars -->
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #334155; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #475569; 
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans h-screen w-screen overflow-hidden">
    <div id="root" class="h-full w-full"></div>

    <!-- Application Script -->
    <script type="text/babel" data-type="module">
        // Import Dependencies using Import Map keys
        import React, { useState, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, AreaChart, Area 
        } from 'recharts';
        import { 
            Server, Database, AlertTriangle, Activity, ArrowRight, DollarSign, Calculator, Settings, CheckCircle2, ShieldCheck, Coins, Lightbulb, XCircle
        } from 'lucide-react';

        // --- COMPONENTS ---

        const Card = ({ children, className = "" }) => (
            <div className={`bg-slate-800 border border-slate-700 rounded-lg shadow-lg ${className}`}>
                {children}
            </div>
        );

        const SectionTitle = ({ title, icon: Icon }) => (
            <h2 className="text-xl font-bold text-white flex items-center gap-2 mb-4">
                {Icon && <Icon className="w-5 h-5 text-orange-500" />}
                {title}
            </h2>
        );

        // --- MAIN APPLICATION ---

        function App() {
            const [activeTab, setActiveTab] = useState('dashboard'); // dashboard, details, settings

            // --- CONFIGURATION STATE ---
            const [config, setConfig] = useState({
                // Environment
                clusterCount: 6,
                nodesPerCluster: 50,
                baseDataTB: 200,
                annualDataGrowth: 0.20,
                
                // Unit Economics (Base prices in USD)
                computeHourlyCost: 0.40,
                storageCostPerTByear: 500,
                backupCostPerTBmonth: 23,
                
                // People & Risk (Base prices in USD)
                adminSalary: 180000,
                devHourlyRate: 100,
                downtimeHourlyCost: 100000,
                
                // Licenses (List Prices in USD)
                licenseCSI: 0,
                licenseEssentials: 0,
                licenseEnterprise: 5000,
                
                // Enterprise Discount
                enterpriseDiscount: 0,

                // Currency Settings
                currency: 'USD', // 'USD' or 'ZAR'
                exchangeRate: 18.0, // Default 1 USD = 18 ZAR
            });

            // --- CONSTANTS (Multipliers) ---
            const multipliers = {
                csi: {
                    computeOverhead: 1.20,
                    storageOverhead: 1.8,
                    backupMultiplier: 3.0,
                    adminFTE: 1.0,
                    devHoursLost: 3000,
                    downtimeHours: 8,
                    externalBackupLicense: 400, // per node
                    deployCostY1: 0,
                },
                essentials: {
                    computeOverhead: 1.10,
                    storageOverhead: 1.6,
                    backupMultiplier: 2.5,
                    adminFTE: 0.7,
                    devHoursLost: 2000,
                    downtimeHours: 4,
                    externalBackupLicense: 250, // per node
                    deployCostY1: 50000,
                },
                enterprise: {
                    computeOverhead: 1.05,
                    storageOverhead: 1.4,
                    backupMultiplier: 2.0,
                    adminFTE: 0.4,
                    devHoursLost: 1000,
                    downtimeHours: 1,
                    externalBackupLicense: 100, // per node
                    deployCostY1: 100000,
                }
            };

            // --- CALCULATION ENGINE ---
            const results = useMemo(() => {
                const totalNodes = config.clusterCount * config.nodesPerCluster;
                const hoursPerYear = 8760;
                
                // Costs are calculated in BASE CURRENCY (USD) first
                const computeCostPerNodeYear = config.computeHourlyCost * hoursPerYear;
                const backupCostPerTByear = config.backupCostPerTBmonth * 12;
                const entLicenseCost = config.licenseEnterprise * (1 - (config.enterpriseDiscount / 100));

                const scenarios = ['csi', 'essentials', 'enterprise'];
                const years = [1, 2, 3];
                
                const data = {};

                scenarios.forEach(scenario => {
                    let scenarioTotal = 0;
                    const yearlyBreakdown = [];
                    const m = multipliers[scenario];

                    years.forEach(year => {
                        // Growth logic
                        const growthFactor = Math.pow(1 + config.annualDataGrowth, year - 1);
                        const effectiveData = config.baseDataTB * growthFactor;

                        // 1. Compute Infra
                        const effectiveNodes = totalNodes * m.computeOverhead;
                        const costCompute = effectiveNodes * computeCostPerNodeYear;

                        // 2. Primary Storage
                        const costStorage = effectiveData * m.storageOverhead * config.storageCostPerTByear;

                        // 3. Backup Storage
                        const costBackupStorage = effectiveData * m.backupMultiplier * backupCostPerTByear;

                        // 4. Licenses
                        let costLicenseCore = 0;
                        if (scenario === 'enterprise') costLicenseCore = totalNodes * entLicenseCost;
                        
                        // External Backup/DR License Cost
                        const costLicenseExternal = totalNodes * m.externalBackupLicense;

                        // 5. Operations (People)
                        const costAdmin = config.adminSalary * m.adminFTE;
                        const costDev = config.devHourlyRate * m.devHoursLost;

                        // 6. Downtime
                        const costDowntime = config.downtimeHourlyCost * m.downtimeHours;

                        // 7. Deploy (Year 1 only)
                        const costDeploy = year === 1 ? m.deployCostY1 : 0;

                        const yearTotal = costCompute + costStorage + costBackupStorage + costLicenseCore + costLicenseExternal + costAdmin + costDev + costDowntime + costDeploy;
                        
                        scenarioTotal += yearTotal;

                        yearlyBreakdown.push({
                            year,
                            infra: costCompute + costStorage + costBackupStorage,
                            licenses: costLicenseCore + costLicenseExternal,
                            peopleRisk: costAdmin + costDev + costDowntime + costDeploy,
                            total: yearTotal
                        });
                    });

                    data[scenario] = {
                        total: scenarioTotal,
                        yearly: yearlyBreakdown
                    };
                });

                return data;
            }, [config]);

            const formatCurrency = (val) => {
                const amount = config.currency === 'ZAR' ? val * config.exchangeRate : val;
                return new Intl.NumberFormat(config.currency === 'ZAR' ? 'en-ZA' : 'en-US', { 
                    style: 'currency', 
                    currency: config.currency, 
                    maximumFractionDigits: 0 
                }).format(amount);
            };

            // Chart Data Preparation
            const totalComparisonData = [
                { name: 'CSI-Only', value: results.csi.total, fill: '#94a3b8' },
                { name: 'PX Essentials', value: results.essentials.total, fill: '#60a5fa' },
                { name: 'PX Enterprise', value: results.enterprise.total, fill: '#f97316' },
            ];

            const yearlyStackData = [1, 2, 3].map((year, idx) => ({
                year: `Year ${year}`,
                csi: results.csi.yearly[idx].total,
                essentials: results.essentials.yearly[idx].total,
                enterprise: results.enterprise.yearly[idx].total,
            }));

            // Convert values for charts (recharts doesn't use the formatter automatically for data points)
            const convert = (val) => config.currency === 'ZAR' ? val * config.exchangeRate : val;

            const chartComparisonData = totalComparisonData.map(d => ({...d, value: convert(d.value)}));
            const chartStackData = yearlyStackData.map(d => ({
                year: d.year,
                csi: convert(d.csi),
                essentials: convert(d.essentials),
                enterprise: convert(d.enterprise)
            }));
            const chartDetailData = [
                { category: 'Infrastructure', csi: convert(results.csi.yearly.reduce((a,b)=>a+b.infra,0)), ess: convert(results.essentials.yearly.reduce((a,b)=>a+b.infra,0)), ent: convert(results.enterprise.yearly.reduce((a,b)=>a+b.infra,0)) },
                { category: 'Licenses', csi: convert(results.csi.yearly.reduce((a,b)=>a+b.licenses,0)), ess: convert(results.essentials.yearly.reduce((a,b)=>a+b.licenses,0)), ent: convert(results.enterprise.yearly.reduce((a,b)=>a+b.licenses,0)) },
                { category: 'Ops & Risk', csi: convert(results.csi.yearly.reduce((a,b)=>a+b.peopleRisk,0)), ess: convert(results.essentials.yearly.reduce((a,b)=>a+b.peopleRisk,0)), ent: convert(results.enterprise.yearly.reduce((a,b)=>a+b.peopleRisk,0)) },
            ];


            return (
                <div className="flex flex-col h-screen bg-slate-900 text-slate-100 font-sans overflow-hidden">
                {/* HEADER */}
                <header className="flex items-center justify-between px-6 py-4 bg-slate-950 border-b border-slate-800 shrink-0">
                    <div className="flex items-center gap-3">
                    <div className="bg-orange-600 p-2 rounded-lg">
                        <Calculator className="w-6 h-6 text-white" />
                    </div>
                    <div>
                        <h1 className="text-xl font-bold tracking-tight">Portworx Value Calculator</h1>
                        <p className="text-xs text-slate-400">3-Year ROI Journey: CSI → Essentials → Enterprise</p>
                    </div>
                    </div>
                    <div className="flex gap-2">
                    <button 
                        onClick={() => setActiveTab('dashboard')}
                        className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${activeTab === 'dashboard' ? 'bg-orange-600 text-white' : 'bg-slate-800 text-slate-300 hover:bg-slate-700'}`}
                    >
                        ROI Dashboard
                    </button>
                    <button 
                        onClick={() => setActiveTab('details')}
                        className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${activeTab === 'details' ? 'bg-orange-600 text-white' : 'bg-slate-800 text-slate-300 hover:bg-slate-700'}`}
                    >
                        Detailed Breakdown
                    </button>
                    </div>
                </header>

                <div className="flex flex-1 overflow-hidden">
                    {/* SIDEBAR CONFIGURATION */}
                    <aside className="w-80 bg-slate-900 border-r border-slate-800 overflow-y-auto p-6 flex flex-col gap-6 custom-scrollbar shrink-0">
                    
                    {/* CURRENCY SETTINGS */}
                    <div className="mb-6 bg-slate-800/50 p-3 rounded-lg border border-slate-700">
                        <h3 className="text-sm font-bold text-slate-300 uppercase tracking-wider mb-3 flex items-center gap-2">
                            <Coins className="w-4 h-4 text-orange-500" /> Currency
                        </h3>
                        <div className="flex gap-2 mb-3">
                            <button 
                                onClick={() => setConfig({...config, currency: 'USD'})}
                                className={`flex-1 py-1 text-xs font-bold rounded ${config.currency === 'USD' ? 'bg-orange-600 text-white' : 'bg-slate-700 text-slate-400'}`}
                            >
                                USD ($)
                            </button>
                            <button 
                                onClick={() => setConfig({...config, currency: 'ZAR'})}
                                className={`flex-1 py-1 text-xs font-bold rounded ${config.currency === 'ZAR' ? 'bg-orange-600 text-white' : 'bg-slate-700 text-slate-400'}`}
                            >
                                ZAR (R)
                            </button>
                        </div>
                        {config.currency === 'ZAR' && (
                            <div>
                                <label className="block text-xs text-slate-400 mb-1">USD to ZAR Rate</label>
                                <div className="flex items-center gap-2">
                                    <span className="text-xs text-slate-500 font-mono">1$ =</span>
                                    <input 
                                        type="number" 
                                        value={config.exchangeRate}
                                        onChange={(e) => setConfig({...config, exchangeRate: Number(e.target.value)})}
                                        className="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-orange-500 outline-none"
                                    />
                                    <span className="text-xs text-slate-500 font-mono">R</span>
                                </div>
                            </div>
                        )}
                    </div>

                    <div>
                        <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                        <Settings className="w-4 h-4" /> Environment
                        </h3>
                        <div className="space-y-4">
                        
                        {/* CUSTOMIZABLE WORKER NODES */}
                        <div className="grid grid-cols-2 gap-2">
                            <div>
                                <label className="block text-xs text-slate-400 mb-1">Clusters</label>
                                <input 
                                    type="number" 
                                    value={config.clusterCount}
                                    onChange={(e) => setConfig({...config, clusterCount: Number(e.target.value)})}
                                    className="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 focus:ring-1 focus:ring-orange-500 outline-none"
                                />
                            </div>
                            <div>
                                <label className="block text-xs text-slate-400 mb-1">Nodes/Cluster</label>
                                <input 
                                    type="number" 
                                    value={config.nodesPerCluster}
                                    onChange={(e) => setConfig({...config, nodesPerCluster: Number(e.target.value)})}
                                    className="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 focus:ring-1 focus:ring-orange-500 outline-none"
                                />
                            </div>
                        </div>
                        <div>
                            <label className="block text-xs text-slate-500 mb-1">Total Nodes (Calculated)</label>
                            <input 
                                type="number" 
                                value={config.clusterCount * config.nodesPerCluster}
                                readOnly
                                className="w-full bg-slate-800/50 border border-slate-800 rounded px-3 py-2 text-slate-500 cursor-not-allowed"
                            />
                        </div>

                        <div>
                            <label className="block text-xs text-slate-400 mb-1">Year 1 Data (TB)</label>
                            <input 
                            type="number" 
                            value={config.baseDataTB}
                            onChange={(e) => setConfig({...config, baseDataTB: Number(e.target.value)})}
                            className="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 focus:ring-1 focus:ring-orange-500 outline-none"
                            />
                        </div>
                        <div>
                            <label className="block text-xs text-slate-400 mb-1">Annual Data Growth (%)</label>
                            <input 
                            type="number" 
                            value={Math.round(config.annualDataGrowth * 100)}
                            onChange={(e) => setConfig({...config, annualDataGrowth: Number(e.target.value) / 100})}
                            className="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 focus:ring-1 focus:ring-orange-500 outline-none"
                            />
                        </div>
                        </div>
                    </div>

                    <div className="border-t border-slate-800 pt-6">
                        <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                        <DollarSign className="w-4 h-4" /> Costs & Risk (USD Base)
                        </h3>
                        <div className="space-y-4">
                        <div>
                            <label className="block text-xs text-slate-400 mb-1">Downtime Cost ($/hr)</label>
                            <input 
                            type="number" 
                            value={config.downtimeHourlyCost}
                            onChange={(e) => setConfig({...config, downtimeHourlyCost: Number(e.target.value)})}
                            className="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 focus:ring-1 focus:ring-orange-500 outline-none"
                            />
                        </div>
                        <div>
                            <label className="block text-xs text-slate-400 mb-1">Enterprise List Price ($/node/yr)</label>
                            <input 
                            type="number" 
                            value={config.licenseEnterprise}
                            onChange={(e) => setConfig({...config, licenseEnterprise: Number(e.target.value)})}
                            className="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 focus:ring-1 focus:ring-orange-500 outline-none"
                            />
                        </div>
                        <div>
                            <label className="block text-xs text-orange-400 mb-1 font-medium">Enterprise Discount (%)</label>
                            <input 
                            type="range" 
                            min="0" max="100" 
                            value={config.enterpriseDiscount}
                            onChange={(e) => setConfig({...config, enterpriseDiscount: Number(e.target.value)})}
                            className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-orange-500"
                            />
                            <div className="text-right text-xs text-orange-400 font-bold">{config.enterpriseDiscount}%</div>
                        </div>
                        </div>
                    </div>
                    
                    <div className="mt-auto p-4 bg-blue-900/20 border border-blue-900/50 rounded-lg">
                        <p className="text-xs text-blue-200">
                        <strong>Tip:</strong> All inputs remain in USD base values. The currency toggle only converts the displayed totals.
                        </p>
                    </div>
                    </aside>

                    {/* MAIN CONTENT AREA */}
                    <main className="flex-1 overflow-y-auto p-8 custom-scrollbar">
                    
                    {activeTab === 'dashboard' && (
                        <div className="max-w-6xl mx-auto space-y-8">
                        
                        {/* TOP: 3-YEAR SUMMARY CARDS */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <Card className="p-6 relative overflow-hidden group">
                            <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <Server className="w-16 h-16" />
                            </div>
                            <h3 className="text-lg font-medium text-slate-400 mb-1">CSI-Only (Baseline)</h3>
                            <div className="text-3xl font-bold text-white mb-2">{formatCurrency(results.csi.total)}</div>
                            <div className="flex gap-2 text-xs">
                                <span className="bg-red-500/20 text-red-300 px-2 py-1 rounded">High Risk</span>
                                <span className="bg-slate-700 text-slate-300 px-2 py-1 rounded">High Ops</span>
                            </div>
                            </Card>

                            <Card className="p-6 relative overflow-hidden group border-blue-500/30">
                            <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <CheckCircle2 className="w-16 h-16 text-blue-500" />
                            </div>
                            <h3 className="text-lg font-medium text-blue-400 mb-1">Portworx Essentials</h3>
                            <div className="text-3xl font-bold text-white mb-2">{formatCurrency(results.essentials.total)}</div>
                            <div className="flex gap-2 text-xs mb-3">
                                <span className="bg-green-500/20 text-green-300 px-2 py-1 rounded">Lowest Cost</span>
                            </div>
                            <p className="text-sm text-slate-400">
                                Saves <span className="text-green-400 font-bold">{formatCurrency(results.csi.total - results.essentials.total)}</span> vs CSI
                            </p>
                            </Card>

                            <Card className={`p-6 relative overflow-hidden group ${results.enterprise.total < results.csi.total ? 'border-green-500/50' : 'border-orange-500/50'}`}>
                            <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <ShieldCheck className="w-16 h-16 text-orange-500" />
                            </div>
                            <h3 className="text-lg font-medium text-orange-400 mb-1">Portworx Enterprise</h3>
                            <div className="text-3xl font-bold text-white mb-2">{formatCurrency(results.enterprise.total)}</div>
                            <div className="flex gap-2 text-xs mb-3">
                                <span className="bg-orange-500/20 text-orange-300 px-2 py-1 rounded">Zero Data Loss</span>
                                <span className="bg-orange-500/20 text-orange-300 px-2 py-1 rounded">Automated</span>
                            </div>
                            {results.enterprise.total > results.csi.total ? (
                                <p className="text-sm text-slate-400">
                                Premium of <span className="text-orange-400 font-bold">{formatCurrency(results.enterprise.total - results.csi.total)}</span> for full DR/HA
                                </p>
                            ) : (
                                <p className="text-sm text-slate-400">
                                Saves <span className="text-green-400 font-bold">{formatCurrency(results.csi.total - results.enterprise.total)}</span> vs CSI
                                </p>
                            )}
                            </Card>
                        </div>

                        {/* MIDDLE: CHARTS */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            {/* 3-Year TCO Comparison Bar Chart */}
                            <Card className="p-6">
                            <SectionTitle title="3-Year TCO Comparison" icon={DollarSign} />
                            <div className="h-72">
                                <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={chartComparisonData} layout="vertical" margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" horizontal={false} />
                                    <XAxis type="number" hide />
                                    <YAxis dataKey="name" type="category" width={120} tick={{fill: '#94a3b8'}} />
                                    <Tooltip 
                                    contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', color: '#fff' }} 
                                    formatter={(value) => formatCurrency(config.currency === 'ZAR' ? value / config.exchangeRate : value)} // Tooltip hack: we pass converted value, format expects raw if we didn't double convert. Actually formatCurrency handles conversion.
                                    // Better approach: Tooltip just needs to display formatted string. 
                                    // Since data is already converted in chartComparisonData, we should simple format it as currency without re-multiplying.
                                    // Let's create a display-only formatter.
                                    />
                                    <Bar dataKey="value" radius={[0, 4, 4, 0]} barSize={40}>
                                    </Bar>
                                </BarChart>
                                </ResponsiveContainer>
                            </div>
                            </Card>

                            {/* Yearly Spend Trend */}
                            <Card className="p-6">
                            <SectionTitle title="Cumulative Spend Over Time" icon={Activity} />
                            <div className="h-72">
                                <ResponsiveContainer width="100%" height="100%">
                                <AreaChart data={chartStackData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>
                                    <defs>
                                    <linearGradient id="colorCSI" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="5%" stopColor="#94a3b8" stopOpacity={0.8}/>
                                        <stop offset="95%" stopColor="#94a3b8" stopOpacity={0}/>
                                    </linearGradient>
                                    <linearGradient id="colorEnt" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="5%" stopColor="#f97316" stopOpacity={0.8}/>
                                        <stop offset="95%" stopColor="#f97316" stopOpacity={0}/>
                                    </linearGradient>
                                    </defs>
                                    <XAxis dataKey="year" tick={{fill: '#94a3b8'}} />
                                    <YAxis tickFormatter={(val) => {
                                        const millions = val / 1000000;
                                        return `${config.currency === 'ZAR' ? 'R' : '$'}${millions.toFixed(1)}M`;
                                    }} tick={{fill: '#94a3b8'}} />
                                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                                    <Tooltip contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', color: '#fff' }} formatter={(value) => new Intl.NumberFormat(config.currency === 'ZAR' ? 'en-ZA' : 'en-US', { style: 'currency', currency: config.currency, maximumFractionDigits: 0 }).format(value)} />
                                    <Legend />
                                    <Area type="monotone" dataKey="csi" stroke="#94a3b8" fillOpacity={1} fill="url(#colorCSI)" name="CSI-Only" />
                                    <Area type="monotone" dataKey="enterprise" stroke="#f97316" fillOpacity={1} fill="url(#colorEnt)" name="Enterprise" />
                                </AreaChart>
                                </ResponsiveContainer>
                            </div>
                            </Card>
                        </div>

                        {/* BOTTOM: OPERATIONAL METRICS */}
                        <Card className="p-6">
                            <SectionTitle title="Operational Impact & Risk Profile" icon={AlertTriangle} />
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mt-6">
                                <div className="space-y-4">
                                <h4 className="font-semibold text-slate-300 border-b border-slate-700 pb-2">Infrastructure Efficiency</h4>
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-slate-400">Compute Overhead</span>
                                    <div className="flex gap-2">
                                    <span className="text-slate-500">1.2x</span>
                                    <ArrowRight className="w-4 h-4 text-slate-600" />
                                    <span className="text-orange-400 font-bold">1.05x</span>
                                    </div>
                                </div>
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-slate-400">Storage Overhead</span>
                                    <div className="flex gap-2">
                                    <span className="text-slate-500">1.8x</span>
                                    <ArrowRight className="w-4 h-4 text-slate-600" />
                                    <span className="text-orange-400 font-bold">1.4x</span>
                                    </div>
                                </div>
                                </div>

                                <div className="space-y-4">
                                <h4 className="font-semibold text-slate-300 border-b border-slate-700 pb-2">Productivity</h4>
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-slate-400">Admin FTE Req.</span>
                                    <div className="flex gap-2">
                                    <span className="text-slate-500">1.0</span>
                                    <ArrowRight className="w-4 h-4 text-slate-600" />
                                    <span className="text-green-400 font-bold">0.4</span>
                                    </div>
                                </div>
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-slate-400">Dev Hours Lost</span>
                                    <div className="flex gap-2">
                                    <span className="text-slate-500">3000</span>
                                    <ArrowRight className="w-4 h-4 text-slate-600" />
                                    <span className="text-green-400 font-bold">1000</span>
                                    </div>
                                </div>
                                </div>

                                <div className="space-y-4">
                                <h4 className="font-semibold text-slate-300 border-b border-slate-700 pb-2">Risk</h4>
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-slate-400">Downtime Hours/Yr</span>
                                    <div className="flex gap-2">
                                    <span className="text-slate-500">8 hrs</span>
                                    <ArrowRight className="w-4 h-4 text-slate-600" />
                                    <span className="text-green-400 font-bold">1 hr</span>
                                    </div>
                                </div>
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-slate-400">RPO Capability</span>
                                    <div className="flex gap-2">
                                    <span className="text-slate-500">Hours</span>
                                    <ArrowRight className="w-4 h-4 text-slate-600" />
                                    <span className="text-orange-400 font-bold">Zero</span>
                                    </div>
                                </div>
                                </div>

                            </div>
                        </Card>

                        </div>
                    )}

                    {activeTab === 'details' && (
                        <div className="max-w-6xl mx-auto space-y-8">
                        <Card className="p-6">
                            <SectionTitle title="Cost Structure Breakdown (3-Year Total)" icon={Calculator} />
                            <div className="h-80">
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={chartDetailData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                                    <XAxis dataKey="category" tick={{fill: '#cbd5e1'}} />
                                    <YAxis tickFormatter={(val) => {
                                        const millions = val / 1000000;
                                        return `${config.currency === 'ZAR' ? 'R' : '$'}${millions.toFixed(1)}M`;
                                    }} tick={{fill: '#cbd5e1'}} />
                                    <Tooltip cursor={{fill: 'transparent'}} contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', color: '#fff' }} formatter={(value) => new Intl.NumberFormat(config.currency === 'ZAR' ? 'en-ZA' : 'en-US', { style: 'currency', currency: config.currency, maximumFractionDigits: 0 }).format(value)} />
                                    <Legend />
                                    <Bar dataKey="csi" name="CSI-Only" fill="#94a3b8" />
                                    <Bar dataKey="ess" name="PX Essentials" fill="#60a5fa" />
                                    <Bar dataKey="ent" name="PX Enterprise" fill="#f97316" />
                                </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </Card>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            {['csi', 'essentials', 'enterprise'].map(scenario => (
                            <Card key={scenario} className={`p-4 border-t-4 ${scenario === 'csi' ? 'border-t-slate-500' : scenario === 'essentials' ? 'border-t-blue-500' : 'border-t-orange-500'}`}>
                                <h3 className="text-lg font-bold capitalize mb-4">{scenario === 'csi' ? 'CSI-Only' : `PX ${scenario}`}</h3>
                                <div className="space-y-3">
                                <div className="flex justify-between border-b border-slate-700 pb-1">
                                    <span className="text-slate-400 text-sm">Compute</span>
                                    <span className="text-white font-mono text-sm">{formatCurrency(results[scenario].yearly.reduce((a,b)=>a+b.infra,0))}</span>
                                </div>
                                <div className="flex justify-between border-b border-slate-700 pb-1">
                                    <span className="text-slate-400 text-sm">Licenses</span>
                                    <span className="text-white font-mono text-sm">{formatCurrency(results[scenario].yearly.reduce((a,b)=>a+b.licenses,0))}</span>
                                </div>
                                <div className="flex justify-between border-b border-slate-700 pb-1">
                                    <span className="text-slate-400 text-sm">Ops & Downtime</span>
                                    <span className="text-white font-mono text-sm">{formatCurrency(results[scenario].yearly.reduce((a,b)=>a+b.peopleRisk,0))}</span>
                                </div>
                                <div className="flex justify-between pt-2">
                                    <span className="text-white font-bold">Total</span>
                                    <span className="text-orange-400 font-bold font-mono">{formatCurrency(results[scenario].total)}</span>
                                </div>
                                </div>
                            </Card>
                            ))}
                        </div>

                        <Card className="p-6 bg-slate-800/50">
                            <SectionTitle title="Strategic Analysis: Cost Drivers" icon={Activity} />
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <h3 className="font-bold text-lg mb-4 text-white">Why Costs Differ (Technical)</h3>
                                    <div className="space-y-6">
                                        <div className="relative pl-4 border-l-2 border-slate-700">
                                            <h4 className="text-slate-300 text-sm font-bold uppercase tracking-wide mb-1">CSI-Only (High Overhead)</h4>
                                            <p className="text-sm text-slate-400 leading-relaxed">
                                                Lacks Kubernetes-aware capacity management, leading to <strong>thick provisioning</strong> and manual safety buffers.
                                                <br/>
                                                <span className="text-xs text-red-400 block mt-1">Impact: 1.8x Storage Overhead, 1.2x Compute Overhead</span>
                                            </p>
                                        </div>
                                        <div className="relative pl-4 border-l-2 border-blue-500/50">
                                            <h4 className="text-blue-400 text-sm font-bold uppercase tracking-wide mb-1">PX Essentials (Transitional)</h4>
                                            <p className="text-sm text-slate-400 leading-relaxed">
                                                Introduces <strong>thin provisioning</strong> and basic storage pooling, improving utilization by removing some manual buffers.
                                                <br/>
                                                <span className="text-xs text-blue-400 block mt-1">Impact: 1.6x Storage Overhead, 1.1x Compute Overhead</span>
                                            </p>
                                        </div>
                                        <div className="relative pl-4 border-l-2 border-orange-500">
                                            <h4 className="text-orange-400 text-sm font-bold uppercase tracking-wide mb-1">PX Enterprise (Optimized)</h4>
                                            <p className="text-sm text-slate-400 leading-relaxed">
                                                <strong>Autopilot</strong> automates capacity expansion (trimming buffers). <strong>PX-Store</strong> optimizes volume placement for density.
                                                <br/>
                                                <span className="text-xs text-orange-400 block mt-1">Impact: 1.4x Storage Overhead, 1.05x Compute Overhead</span>
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h3 className="font-bold text-lg mb-4 text-white">ROI Summary</h3>
                                    <ul className="list-disc pl-5 space-y-4 text-slate-300">
                                        <li>
                                            <strong className="text-blue-400 block mb-1">Essentials is the Efficiency Play</strong> 
                                            It acts as a massive cost saver ({formatCurrency(results.csi.total - results.essentials.total)} savings) simply by reducing the storage waste and backup footprint inherent in raw CSI implementations.
                                        </li>
                                        <li>
                                            <strong className="text-orange-400 block mb-1">Enterprise is the Strategic Play</strong> 
                                            While it requires a license investment, it drastically reduces operational risk. 
                                            {results.enterprise.total > results.csi.total 
                                                ? " Although the modeled TCO is slightly higher at list price, the reduction in downtime (8h → 1h) and RPO (Hours → Zero) justifies the premium for production-critical apps."
                                                : " With the applied discount, Enterprise is cheaper than CSI-Only while delivering superior DR and automation capabilities."}
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </Card>

                        {/* NEW STRATEGIC ADVISORY CARD */}
                        <Card className="p-6 bg-slate-800/50 border border-orange-500/20">
                            <SectionTitle title="Strategic Advisory: The Case for PX-CSI over Essentials" icon={Lightbulb} />
                            
                            <div className="grid grid-cols-1 gap-6">
                                {/* WARNING BANNER */}
                                <div className="bg-slate-900/50 p-4 rounded-lg border border-red-900/30 flex items-start gap-4">
                                    <div className="p-2 bg-red-500/10 rounded-lg shrink-0">
                                        <XCircle className="w-6 h-6 text-red-500" />
                                    </div>
                                    <div>
                                        <h4 className="text-white font-bold text-lg">Warning: Portworx Essentials is End-of-Life</h4>
                                        <p className="text-slate-400 text-sm mt-1">
                                            Essentials is discontinued as of Portworx 3.2.2.1. Clusters cannot upgrade to newer releases, and upon license expiry, customers lose core capabilities (creating volumes/snapshots). It is a "dead end" for new projects.
                                        </p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-12">
                                    {/* COLUMN 1: ARCHITECTURE & OPS */}
                                    <div>
                                        <h4 className="font-bold text-white mb-4 border-b border-slate-700 pb-2">Technical & Operational Superiority</h4>
                                        <ul className="space-y-4">
                                            <li className="flex gap-3">
                                                <CheckCircle2 className="w-5 h-5 text-green-500 shrink-0 mt-0.5" />
                                                <div>
                                                    <strong className="text-slate-200 block text-sm">Cleaner Kubernetes-Native Architecture</strong>
                                                    <span className="text-slate-400 text-xs leading-relaxed block mt-1">
                                                        PX-CSI stores metadata as Kubernetes CustomResources (PureVolume, PureSnapshot) in etcd, completely removing the external KVDB. This makes it easier to reason about and troubleshoot via standard <code>kubectl</code>.
                                                    </span>
                                                </div>
                                            </li>
                                            <li className="flex gap-3">
                                                <CheckCircle2 className="w-5 h-5 text-green-500 shrink-0 mt-0.5" />
                                                <div>
                                                    <strong className="text-slate-200 block text-sm">Operational Simplicity (No pxctl)</strong>
                                                    <span className="text-slate-400 text-xs leading-relaxed block mt-1">
                                                        In PX-CSI, the legacy <code>pxctl</code> tool is deprecated. Operations are managed declaratively via YAML and standard CSI objects, aligning perfectly with GitOps workflows and modern K8s teams.
                                                    </span>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>

                                    {/* COLUMN 2: INTEGRATION & MIGRATION */}
                                    <div>
                                        <h4 className="font-bold text-white mb-4 border-b border-slate-700 pb-2">Pure Storage Integration & Future</h4>
                                        <ul className="space-y-4">
                                            <li className="flex gap-3">
                                                <CheckCircle2 className="w-5 h-5 text-green-500 shrink-0 mt-0.5" />
                                                <div>
                                                    <strong className="text-slate-200 block text-sm">Purpose-Built for FlashArray/FlashBlade</strong>
                                                    <span className="text-slate-400 text-xs leading-relaxed block mt-1">
                                                        PX-CSI is explicitly positioned as the orchestrator for Pure backends, shipping with default StorageClasses (e.g., <code>px-fa-direct-access</code>) and rapid feature iteration (NVMe-oF, File Services, Cloning).
                                                    </span>
                                                </div>
                                            </li>
                                            <li className="flex gap-3">
                                                <CheckCircle2 className="w-5 h-5 text-green-500 shrink-0 mt-0.5" />
                                                <div>
                                                    <strong className="text-slate-200 block text-sm">Clear Migration Path</strong>
                                                    <span className="text-slate-400 text-xs leading-relaxed block mt-1">
                                                        There is a supported path to flip Essentials clusters to PX-CSI mode, allowing you to resume upgrades and access new features. Essentials is a stop-gap; PX-CSI is the long-term supported platform.
                                                    </span>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </Card>

                        </div>
                    )}

                    </main>
                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
